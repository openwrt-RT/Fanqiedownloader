```markdown
# 番茄小说EPUB下载器

一个用于下载番茄小说内容并生成EPUB文件的Python脚本。

## 功能特性

- 通过API自动获取章节列表
- 多线程下载章节内容（可配置线程数）
- 自动提取书籍元数据（书名、作者、封面）
- 生成符合规范的EPUB电子书文件
- 自动清理非法文件名字符

## 依赖环境

- Python 3.6+
- 依赖库安装命令：
```bash
pip install requests tqdm ebooklib beautifulsoup4
```

## 使用方法

### 基本命令
```bash
python get2.py <book_id> [--threads THREAD_COUNT]
```

### 参数说明
- `book_id`：必需参数，小说的唯一标识ID
- `-t/--threads`：可选参数，下载线程数（默认8，建议不超过16）

### 示例
```bash
# 使用默认8线程下载
python get2.py 12345

# 使用12线程下载
python get2.py 12345 -t 12
```

## 输出文件

生成的EPUB文件将保存在当前目录，文件名格式：`<书名>.epub`

## 注意事项

1. 需要从目标网站获取正确的`book_id`才能下载
2. 线程数过高可能导致IP被暂时限制，建议保持合理并发
3. 封面图片依赖API返回的有效链接
4. 部分章节下载失败时会自动跳过（控制台会有错误提示）
5. 生成的文件名会自动移除非法字符（`\\/*?:"<>|`）

## 实现原理

1. 通过API获取书籍章节元数据
2. 并行下载所有章节内容
3. 使用`ebooklib`构建EPUB文档结构
4. 自动添加书籍封面和目录导航
5. 使用BeautifulSoup进行HTML内容清理

## 常见问题

### 如何获取book_id？
番茄小说官网搜索书名点进去，得到网址例如`https://fanqienovel.com/page/7143038691944959011`，其中的`7143038691944959011` 就是book_id

### 下载失败怎么办？
- 检查网络连接是否正常
- 降低线程数重试（如 `-t 4`）
- 确认输入的book_id有效
- 查看控制台输出的错误信息

### 生成的EPUB兼容性
生成的EPUB文件已通过主流阅读器（Calibre、Apple Books、Kindle）测试验证。
